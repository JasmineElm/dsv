# Databases

As a data scientist, you will often need to work with databases to extract,
transform and load data. In this section, we will introduce you to the basics of
databases and show you how to work with them using SQL.

A database is a collection of data that is stored in a computer system.
Databases allow data to be easily accessed, managed, and updated. Databases are
used in a wide range of applications, from simple contact lists to complex
financial systems.

Databases come in many different forms, but the most common type is a relational
database. In a relational database, data is stored in tables, which are made up
of rows and columns. Each row in a table represents a single record, while each
column represents a different attribute of the record. For example, a table of
customers might have columns for `name`, `address`, and `phone number`.

Relational databases are typically accessed using a language called SQL
(Structured Query Language). SQL is a powerful language that allows you to
query, update, and manage data in a database. There are many _dialects_ of SQL
but the basic syntax is common across all of them; selecting data from a table
will look the same in SQLite as it does in MySQL, for example. The dialects
however have some differences in the advanced features they support, and the way
they handle certain types of data. These more advanced features make dialects
much closer to a fully featured programming language than the basic SQL syntax.

| Flavour       | Description                                                                            | SQL Dialect |
| ------------- | -------------------------------------------------------------------------------------- | ----------- |
| SQLite        | A lightweight, serverless, self-contained, and zero-configuration SQL database engine. | SQLite      |
| MySQL/MariaDB | An open-source relational database management system.                                  | MySQL       |
| PostgreSQL    | An open-source object-relational database system.                                      | PostgreSQL  |
| Oracle        | A commercial relational database management system.                                    | PL/SQL      |
| SQL Server    | A commercial relational database management system from Microsoft                      | T-SQL       |

### Activity 3.1.1 Install a sqlite3 database browser

The activities in this section will use a sqlite3 database. There are a number
of options for working with sqlite3 databases, including command line tools and
graphical user interfaces. Here are a few options:

| Tool                                                                                                    | Notes                                                | Installation                                                                                                                                                                     |
| ------------------------------------------------------------------------------------------------------- | ---------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| [DB Browser for SQLite](https://sqlitebrowser.org/)                                                     | Simple and easy to use GUI for working with sqlite3  | `brew install --cask db-browser-for-sqlite` (MacOS) <br> `sudo apt install sqlitebrowser` (Debian & derivatives)<br> `winget install --id=sqlitebrowser.sqlitebrowser` (Windows) |
| [sqlite3](https://www.sqlite.org/index.html)                                                            | Command line tool for working with sqlite3 databases | `brew install sqlite` (MacOS) <br> `sudo apt install sqlite3` (Debian & derivatives) <br> `winget install --id=sqlite.sqlite` (Windows)                                          |
| [sqlite (VSCode extension)](https://marketplace.visualstudio.com/items?itemName=alexcvzz.vscode-sqlite) | VSCode extension for working with sqlite3 databases  | Install from VSCode marketplace                                                                                                                                                  |

If you are familiar with VSCode, the sqlite extension is a good option;
otherwise, we recommend using DB Browser for SQLite. Whilst the command line
tool is powerful, it can be more difficult to use for beginners. If you are
unable to install any of these tools, you can use the online tool
[SQLite Online](https://sqlite.org/fiddle/index.html).

## Database Objects

Before we get our hands dirty with SQL, let's take a look at some of the key
database objects that you will encounter when working with databases.

### Tables

A table is a collection of data that is organized into rows and columns. Each
row in a table represents a single record, while each column represents a
different attribute of the record. For example, a table of customers might have
columns for `name`, `address`, and `phone number`. Data is added altered or
removed in a table using DML commands. Alongside tables created by the user,
databases typically have system tables that store metadata about the database
itself. These tables allow database Administrators to manage the database and
its objects, as well as monitor performance, security, and other aspects of the
database.

### Views

A view is a virtual table that is based on the result of a SQL query. Views are
a powerful feature of SQL that allow you to create a virtual table that is based
on the result of a query. Views can be used to simplify complex queries,
restrict access to certain columns, or provide a consistent interface to the
underlying data. Views are typically used in reporting to aggregate data from
multiple tables into a single view. Because views are dynamically generated,
data in a view is not stored in the database, but is instead generated
on-the-fly when the view is queried. This means that changes to the underlying
tables will be reflected in the view.

### Indexes

An index is a data structure that is used to speed up the retrieval of data from
a table. Indexes are created on one or more columns in a table, and are used to
quickly locate rows that match a given condition. Indexes can significantly
improve the performance of queries that involve filtering or sorting data.

### Stored Procedures

A stored procedure is a named block of code that performs a specific task. In
some dialects, a stored procedure may be referred to as a `function` Stored
Procedures can be used to encapsulate complex logic, improve performance, and
enforce data integrity. Stored procedures are typically used to perform common
tasks such as inserting, updating, or deleting data in a database. Stored
procedures can also be used to create reusable code that can be called from
other stored procedures or applications.

### Triggers

A trigger is a special type of stored procedure that is automatically executed
when a certain event occurs. Triggers are used to enforce data integrity,
perform auditing, or automate tasks in a database. Triggers can be defined to
act before or after an event, such as inserting, updating, or deleting data in a
table. A common use of triggers is to increment a counter or update a timestamp
when a row is inserted or updated.

### Indexes and Constraints

An index is a data structure that is used to speed up the retrieval of data from a table. Indexes are created on one or more columns in a table, and are used to quickly locate rows that match a given condition. Indexes can significantly improve the performance of queries that involve filtering or sorting data. Constraints are rules that are enforced on the data in a table. Constraints can be used to enforce data integrity, ensure that data is consistent, and prevent invalid data from being inserted into a table. Common constraints include `PRIMARY KEY`, `FOREIGN KEY`, `UNIQUE`, and `CHECK`.

## SQL, DML and DDL

SQL (Structured Query Language) is a powerful language that is used to query,
update, and manage data in a database. SQL is a standard language that is
supported by most relational database management systems (RDBMS). SQL is divided
into two main categories: Data Definition Language (DDL) and Data Manipulation
Language (DML). DDL commands are used to create, modify, and delete database
objects such as tables, indexes, and views. Common DDL commands include
`CREATE TABLE`, `ALTER TABLE`, and `DROP TABLE`. DML commands are used to
insert, update, delete, and retrieve data from database tables. Common DML
commands include `INSERT`, `UPDATE`, `DELETE`, and `SELECT`. In this section, we
will focus on DML commands, as they are the most commonly used commands in data
science.


### Activity 3.1.2 Load a database, and explore the tables

In the [Activity 3.1.2](3.1.2.md) directory, you will load a sample database and explore. Load this database in your sqlite tool of choice.

## Useful links

https://www.linkedin.com/learning/sql-essential-training-20685933/

https://mystery.knightlab.com/

## Steps

```mermaid
erDiagram
    users {
    TEXT 	guid
    DATETIME	DoB
    TEXT	first_name
    TEXT	last_name
    DATETIME	account_created
    INTEGER	is_active
    }
    emails {
        TEXT	user_guid
        TEXT	email
        TEXT	type
        INTEGER	verified
    }
    addresses {
        TEXT	user_guid
        TEXT	address
        TEXT	city
        TEXT	county
        TEXT	postal_code
    }
    orders {
        TEXT	order_id
        TEXT	user_guid
        TEXT	product_guid
        TIMESTAMP	order_datetime
    }
    products {
        TEXT	product_guid
        TEXT	product_name
        REAL	price
        TEXT	category
    }
    visits {
        TEXT	user_guid
        TIMESTAMP	visit_datetime
        INTEGER	distinct_page_views
        INTEGER	time_on_site
        TEXT	source
    }
    users ||--|| emails: has
    users ||--|| addresses: has
    users ||--o{ visits : makes
    users ||--o{ orders : places
    orders ||--o{ products : contains
